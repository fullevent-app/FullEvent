---
title: Node.js SDK
description: The official Node.js SDK for FullEvent.
---

The Node.js SDK is the backbone of your analytics. It's designed to capture the "Wide Event" for every requestâ€”automatically tracking duration, status, and context, while letting you enrich it with business data.

## Installation

```package-install
npm install @fullevent/node
```

## Quick Start

The best way to use the SDK is via middleware. This automatically initializes a Wide Event for every request and sends it when the response is finished.

### Hono Middleware (Recommended)

FullEvent has first-class support for Hono.

```typescript title="src/server.ts"
import { Hono } from 'hono';
import { wideLogger, WideEventVariables } from '@fullevent/node';

const app = new Hono<{ Variables: WideEventVariables }>();

app.use(wideLogger({
  apiKey: process.env.FULLEVENT_API_KEY!,
  service: 'my-api',
}));

app.post('/checkout', async (c) => {
  // Access the event to add your own context
  const event = c.get('wideEvent');
  
  event.user_id = 'usr_123';
  event.cart = { total: 4999, items: 3 };
  
  return c.json({ success: true });
});
```

### Express Middleware

You can also use the Express middleware for traditional Express apps.

```typescript title="src/app.ts"
import express from 'express';
import { expressWideLogger } from '@fullevent/node';

const app = express();

app.use(expressWideLogger({
  apiKey: process.env.FULLEVENT_API_KEY!,
  service: 'my-express-api'
}));

app.get('/', (req, res) => {
  // Access event via req.wideEvent
  req.wideEvent.custom_prop = "hello";
  res.json({ ok: true });
});
```

### Manual Usage / Server Actions

For modern Next.js Server Actions, generic utility functions, or scripts where middleware isn't an option, use the **Singleton Pattern**.

First, create a shared client instance:

```typescript title="lib/fullevent.ts"
import { FullEvent } from "@fullevent/node";

// Create a single instance to reuse
export const fullevent = new FullEvent({
  apiKey: process.env.FULLEVENT_API_KEY!,
});
```

Then import and use it anywhere in your server code:

```typescript title="app/actions.ts"
"use server";
import { fullevent } from "@/lib/fullevent";

export async function createTeam(formData: FormData) {
  // Ingest an event with any properties
  await fullevent.ingest("team.create", {
    team_name: formData.get("name"),
    user_id: "usr_123", // from session
    plan: "starter"
  });

  return { success: true };
}
```

## Core Concepts

### The Wide Event

Instead of logging "User clicked buy" then "Payment started" then "Payment failed" as separate log lines, FullEvent encourages you to build **one** rich object.

```typescript title="Example Wide Event Structure"
// Don't do this
console.log('User 123 clicked buy');
console.log('Cart total 5000');
console.error('Payment failed');

// Do this (The Wide Event)
{
  "request_id": "req_123",
  "user_id": "usr_123",
  "cart": { "total": 5000, "items": 2 },
  "payment": { "status": "failed", "error": "insufficient_funds" },
  "duration_ms": 450,
  "outcome": "error"
}
```

### Using the Event Builder

For more complex scenarios, you can use the `WideEventBuilder` class to build events with a fluent API:

```typescript title="Using the Builder"
import { WideEventBuilder } from '@fullevent/node';

app.post('/checkout', async (c) => {
  const event = c.get('wideEvent');
  const builder = new WideEventBuilder(event);

  builder
    .setUser(user.id)
    .setContext('user', {
      subscription: user.plan,
      account_age_days: daysSince(user.createdAt),
    })
    .setContext('cart', {
      id: cart.id,
      item_count: cart.items.length,
      total_cents: cart.total,
    });

  // Later, after payment processing
  const paymentStart = Date.now();
  try {
    await processPayment(cart);
    builder.setTiming('payment_latency_ms', paymentStart);
  } catch (err) {
    builder.setError(err);
  }

  return c.json({ success: true });
});
```

### Sampling

You can configure sampling to save costs while keeping visibility into errors.

```typescript title="src/middleware.ts"
app.use(wideLogger({
  apiKey: '...',
  service: 'my-service',
  sampling: {
    defaultRate: 0.1, // Keep 10% of success traffic
    alwaysKeepErrors: true, // Keep 100% of errors
    slowRequestThresholdMs: 1000, // Keep anything slower than 1s
    alwaysKeepPaths: ['/api/checkout', '/api/payment'], // Critical paths
    alwaysKeepUsers: ['usr_vip_123'] // Debug specific users
  }
}));
```

## API Reference

### FullEvent Class

The main client for ingesting events.

```typescript
import { FullEvent } from '@fullevent/node';

const client = new FullEvent({
  apiKey: process.env.FULLEVENT_API_KEY!,
  baseUrl: 'https://api.fullevent.app', // optional
  ping: true, // send a test ping on initialization
});
```

#### Methods

**`ingest(event: string, properties: Record<string, unknown>, timestamp?: string)`**

Ingest a generic event with any properties.

```typescript
await client.ingest('checkout.completed', {
  order_id: 'ord_123',
  total_cents: 9999,
  items: 3,
  user: {
    id: 'usr_456',
    plan: 'premium',
  },
});
```

**`ping()`**

Ping the FullEvent API to verify connection.

```typescript
const result = await client.ping();
if (result.success) {
  console.log(`Connected! Latency: ${result.latency_ms}ms`);
} else {
  console.error('Connection failed:', result.error);
}
```

### Middleware Configuration

Both `wideLogger` (Hono) and `expressWideLogger` (Express) accept the same configuration:

```typescript
interface WideLoggerConfig {
  apiKey: string;           // Your FullEvent API key
  service: string;          // Service name for tagging
  baseUrl?: string;         // API base URL (default: https://api.fullevent.app)
  environment?: string;     // Environment tag (default: NODE_ENV)
  region?: string;          // Region tag for multi-region deployments
  sampling?: SamplingConfig; // Sampling configuration
}
```

### Sampling Configuration

```typescript
interface SamplingConfig {
  defaultRate?: number;              // 0.0 - 1.0, default: 1.0
  alwaysKeepErrors?: boolean;        // default: true
  slowRequestThresholdMs?: number;   // default: 2000
  alwaysKeepPaths?: string[];        // Always keep specific paths
  alwaysKeepUsers?: string[];        // Always keep specific user IDs
}
```
